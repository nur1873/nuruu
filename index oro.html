<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HypoChat - Demo</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            --error: #ef4444;
            --success: #22c55e;
            --sidebar-width: 260px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Utils */
        .hidden { display: none !important; }
        .error-text { color: var(--error); font-size: 0.85rem; margin-top: 0.25rem; }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn:hover { background: var(--primary-hover); }
        .btn-danger { background: var(--error); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
        
        input, textarea, select {
            background: #0f172a;
            border: 1px solid var(--border);
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
            width: 100%;
            margin-top: 0.5rem;
        }

        /* Layouts */
        .auth-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 400px;
        }

        .app-container {
            display: flex;
            height: 100vh;
            width: 100%;
        }

        /* Sidebar */
        aside {
            width: var(--sidebar-width);
            background: var(--card-bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 0;
        }

        .category-group {
            margin-bottom: 1.5rem;
        }

        .category-title {
            padding: 0 1.5rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: background 0.2s;
            display: block;
        }

        .nav-item:hover { background: rgba(255,255,255,0.05); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); border-left: 3px solid var(--primary); }

        /* Main Content */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-color);
        }

        .main-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-pill {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        /* Messages */
        .messages-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .message {
            background: var(--card-bg);
            padding: 0.75rem 1rem;
            border-radius: 12px;
            max-width: 80%;
            align-self: flex-start;
        }

        .message.mine {
            background: var(--primary);
            align-self: flex-end;
        }

        .chat-input-area {
            display: flex;
            gap: 0.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        /* Admin Styles */
        .admin-dashboard {
            padding: 2rem;
            overflow-y: auto;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            color: var(--error);
        }

        footer {
            padding: 1rem;
            text-align: center;
            border-top: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .admin-link {
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            aside { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--border); }
            .admin-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- Step 1: Phone Login -->
    <div id="view-step1" class="auth-container">
        <div class="card">
            <h2>Welcome to HypoChat</h2>
            <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Enter your Ethiopian phone number to continue</p>
            <label for="phone-input">Phone Number</label>
            <input type="text" id="phone-input" placeholder="09XXXXXXXX or +2519XXXXXXXX">
            <p id="phone-error" class="error-text hidden">Please enter a valid Ethiopian phone number.</p>
            <button class="btn" style="width: 100%; margin-top: 1.5rem;" onclick="handlePhoneSubmit()">Next</button>
        </div>
    </div>

    <!-- Step 2: Verification -->
    <div id="view-step2" class="auth-container hidden">
        <div class="card">
            <h2>Verification</h2>
            <p style="color: var(--text-muted); margin-bottom: 1rem;">Enter the 5-digit code sent to your phone</p>
            <div class="warning-box" style="color: var(--text-main); border-color: var(--border); background: rgba(255,255,255,0.05);">
                Demo only: any 5-digit code will be accepted. No SMS is sent.
            </div>
            <label for="code-input">5-Digit Code</label>
            <input type="text" id="code-input" maxlength="5" placeholder="12345">
            <p id="code-error" class="error-text hidden">Please enter exactly 5 digits.</p>
            <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
                <button class="btn btn-outline" style="flex: 1;" onclick="switchView('view-step1')">Back</button>
                <button class="btn" style="flex: 2;" onclick="handleCodeSubmit()">Verify</button>
            </div>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="view-app" class="app-container hidden">
        <aside>
            <div class="sidebar-header">
                <h3>HypoChat</h3>
            </div>
            <div class="sidebar-content">
                <div class="category-group">
                    <div class="category-title">Chat Categories</div>
                    <div id="chat-categories-list"></div>
                </div>
                <div class="category-group">
                    <div class="category-title">Photo Categories</div>
                    <div id="photo-categories-list"></div>
                </div>
            </div>
            <footer style="border-top: 1px solid var(--border); border-bottom: none;">
                <a class="admin-link" onclick="switchView('view-admin-login')">Admin Portal</a>
            </footer>
        </aside>
        <main>
            <header class="main-header">
                <div>
                    <h2 id="active-category-name">Welcome</h2>
                    <p id="active-category-desc" style="font-size: 0.85rem; color: var(--text-muted);">Select a category to start</p>
                </div>
                <span class="status-pill">Connected (demo)</span>
            </header>
            <div id="content-display" class="content-area">
                <!-- Chat or Gallery will be rendered here -->
                <div id="empty-state" style="margin: auto; text-align: center; color: var(--text-muted);">
                    <p>Select a category from the sidebar to view content.</p>
                </div>

                <div id="chat-interface" class="hidden" style="height: 100%; display: flex; flex-direction: column;">
                    <div id="messages-container" class="messages-list"></div>
                    <div class="chat-input-area">
                        <input type="text" id="chat-msg-input" placeholder="Type a message...">
                        <button class="btn" onclick="sendMessage()">Send</button>
                    </div>
                </div>

                <div id="photo-interface" class="hidden" style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üñºÔ∏è</div>
                    <h3 id="photo-placeholder-text">Photo gallery placeholder</h3>
                </div>
            </div>
        </main>
    </div>

    <!-- Admin Login -->
    <div id="view-admin-login" class="auth-container hidden">
        <div class="card">
            <h2>Admin Login</h2>
            <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Access internal management dashboard</p>
            <label>Username</label>
            <input type="text" id="admin-user" placeholder="admin">
            <label style="margin-top: 1rem; display: block;">Password</label>
            <input type="password" id="admin-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <p id="admin-login-error" class="error-text hidden">Invalid username or password.</p>
            <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
                <button class="btn btn-outline" style="flex: 1;" onclick="switchView('view-app')">Cancel</button>
                <button class="btn" style="flex: 2;" onclick="handleAdminLogin()">Login</button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="view-admin-dashboard" class="hidden" style="flex: 1; overflow-y: auto; background: var(--bg-color);">
        <header class="main-header" style="background: var(--card-bg);">
            <h2>Admin Dashboard</h2>
            <button class="btn btn-outline" onclick="switchView('view-app')">Exit Admin</button>
        </header>
        
        <div class="admin-dashboard">
            <div class="warning-box">
                <strong>Notice:</strong> This is a front-end-only prototype. No real authentication or encryption. Do not use in production or with sensitive data. Admin can see all local activity logs.
            </div>

            <div class="admin-grid">
                <!-- Manage Categories -->
                <div>
                    <div class="card" style="max-width: none; margin-bottom: 2rem;">
                        <h3>Add New Category</h3>
                        <label>Name</label>
                        <input type="text" id="new-cat-name">
                        <label style="margin-top: 1rem; display: block;">Description</label>
                        <input type="text" id="new-cat-desc">
                        <label style="margin-top: 1rem; display: block;">Type</label>
                        <select id="new-cat-type">
                            <option value="chat">Chat</option>
                            <option value="photo">Photo</option>
                        </select>
                        <button class="btn" style="width: 100%; margin-top: 1.5rem;" onclick="addCategory()">Add Category</button>
                    </div>
                </div>

                <!-- User Activity -->
                <div>
                    <div class="card" style="max-width: none;">
                        <h3>Recent Login Activity</h3>
                        <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">Logged in this session</p>
                        <div style="overflow-x: auto;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Phone</th>
                                        <th>Code</th>
                                        <th>Time</th>
                                    </tr>
                                </thead>
                                <tbody id="activity-log-table">
                                    <!-- Table rows injected here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Existing Categories List -->
            <div class="card" style="max-width: none; margin-top: 2rem;">
                <h3>Current Categories</h3>
                <div style="overflow-x: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Type</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="admin-categories-table">
                            <!-- Table rows injected here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        let currentUser = null;
        let activityLogs = JSON.parse(localStorage.getItem('hypochat_logs') || '[]');
        let categories = JSON.parse(localStorage.getItem('hypochat_cats') || JSON.stringify([
            { id: 1, name: 'Friends', desc: 'General chat with friends', type: 'chat' },
            { id: 2, name: 'Work', desc: 'Professional discussions', type: 'chat' },
            { id: 3, name: 'Family', desc: 'Private family group', type: 'chat' },
            { id: 4, name: 'Summer Trip', desc: 'Vacation memories', type: 'photo' },
            { id: 5, name: 'Portfolio', desc: 'Creative works', type: 'photo' }
        ]));
        let messages = {}; // Store messages by category ID in memory

        let activeCategoryId = null;

        // --- View Switching ---
        function switchView(viewId) {
            document.querySelectorAll('body > div').forEach(div => {
                div.classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
            
            if (viewId === 'view-app') {
                renderUserCategories();
            } else if (viewId === 'view-admin-dashboard') {
                renderAdminDashboard();
            }
        }

        // --- Authentication ---
        function validateEthiopianPhone(phone) {
            const regex = /^(\+2519\d{8}|09\d{8})$/;
            return regex.test(phone);
        }

        function handlePhoneSubmit() {
            const phoneInput = document.getElementById('phone-input');
            const phoneError = document.getElementById('phone-error');
            
            if (validateEthiopianPhone(phoneInput.value)) {
                phoneError.classList.add('hidden');
                currentUser = { phone: phoneInput.value };
                switchView('view-step2');
            } else {
                phoneError.classList.remove('hidden');
            }
        }

        function handleCodeSubmit() {
            const codeInput = document.getElementById('code-input');
            const codeError = document.getElementById('code-error');
            
            if (/^\d{5}$/.test(codeInput.value)) {
                codeError.classList.add('hidden');
                
                // Log activity
                const logEntry = {
                    phone: currentUser.phone,
                    code: codeInput.value,
                    timestamp: new Date().toLocaleString()
                };
                activityLogs.push(logEntry);
                localStorage.setItem('hypochat_logs', JSON.stringify(activityLogs));
                
                switchView('view-app');
            } else {
                codeError.classList.remove('hidden');
            }
        }

        // --- Admin Logic ---
        function handleAdminLogin() {
            const user = document.getElementById('admin-user').value;
            const pass = document.getElementById('admin-pass').value;
            const err = document.getElementById('admin-login-error');

            if (user === 'admin' && pass === 'admin123') {
                err.classList.add('hidden');
                switchView('view-admin-dashboard');
            } else {
                err.classList.remove('hidden');
            }
        }

        function renderAdminDashboard() {
            // Activity Logs
            const logTable = document.getElementById('activity-log-table');
            logTable.innerHTML = activityLogs.map(log => `
                <tr>
                    <td>${log.phone}</td>
                    <td>${log.code}</td>
                    <td>${log.timestamp}</td>
                </tr>
            `).reverse().join('');

            // Categories
            const catTable = document.getElementById('admin-categories-table');
            catTable.innerHTML = categories.map(cat => `
                <tr>
                    <td>${cat.name}</td>
                    <td>${cat.desc}</td>
                    <td style="text-transform: capitalize;">${cat.type}</td>
                    <td><button class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" onclick="deleteCategory(${cat.id})">Delete</button></td>
                </tr>
            `).join('');
        }

        function addCategory() {
            const name = document.getElementById('new-cat-name').value;
            const desc = document.getElementById('new-cat-desc').value;
            const type = document.getElementById('new-cat-type').value;

            if (!name) return alert('Name is required');

            const newCat = {
                id: Date.now(),
                name,
                desc,
                type
            };

            categories.push(newCat);
            saveCategories();
            renderAdminDashboard();
            
            // Reset form
            document.getElementById('new-cat-name').value = '';
            document.getElementById('new-cat-desc').value = '';
        }

        function deleteCategory(id) {
            categories = categories.filter(c => c.id !== id);
            saveCategories();
            renderAdminDashboard();
        }

        function saveCategories() {
            localStorage.setItem('hypochat_cats', JSON.stringify(categories));
        }

        // --- User App Logic ---
        function renderUserCategories() {
            const chatList = document.getElementById('chat-categories-list');
            const photoList = document.getElementById('photo-categories-list');
            
            chatList.innerHTML = '';
            photoList.innerHTML = '';

            categories.forEach(cat => {
                const item = document.createElement('div');
                item.className = `nav-item ${activeCategoryId === cat.id ? 'active' : ''}`;
                item.innerText = cat.name;
                item.onclick = () => selectCategory(cat);
                
                if (cat.type === 'chat') {
                    chatList.appendChild(item);
                } else {
                    photoList.appendChild(item);
                }
            });
        }

        function selectCategory(cat) {
            activeCategoryId = cat.id;
            renderUserCategories(); // Refresh active state in sidebar

            document.getElementById('active-category-name').innerText = cat.name;
            document.getElementById('active-category-desc').innerText = cat.desc || '';
            document.getElementById('empty-state').classList.add('hidden');

            if (cat.type === 'chat') {
                document.getElementById('chat-interface').classList.remove('hidden');
                document.getElementById('photo-interface').classList.add('hidden');
                renderMessages();
            } else {
                document.getElementById('chat-interface').classList.add('hidden');
                document.getElementById('photo-interface').classList.remove('hidden');
                document.getElementById('photo-placeholder-text').innerText = `Photo gallery placeholder for ${cat.name}`;
            }
        }

        function renderMessages() {
            const container = document.getElementById('messages-container');
            container.innerHTML = '';
            
            const catMsgs = messages[activeCategoryId] || [];
            catMsgs.forEach(msg => {
                const div = document.createElement('div');
                div.className = `message ${msg.mine ? 'mine' : ''}`;
                div.innerText = msg.text;
                container.appendChild(div);
            });
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('chat-msg-input');
            const text = input.value.trim();
            if (!text || !activeCategoryId) return;

            if (!messages[activeCategoryId]) messages[activeCategoryId] = [];
            
            messages[activeCategoryId].push({
                text: text,
                mine: true,
                time: new Date()
            });

            input.value = '';
            renderMessages();
        }

        // Allow "Enter" to send message
        document.getElementById('chat-msg-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

    </script>
</body>
</html>
